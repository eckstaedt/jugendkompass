!function(){"use strict";function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw i}}}}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=s(e);if(t){var a=s(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return c(this,r)}}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(self.webpackChunkjugendkompass=self.webpackChunkjugendkompass||[]).push([[5143],{85075:function(r,n,c){c.r(n),c.d(n,{FilesystemWeb:function(){return l}});var s=c(8239),f=c(68384);function d(e){var t=e.split("/").filter(function(e){return"."!==e}),r=[];return t.forEach(function(e){".."===e&&r.length>0&&".."!==r[r.length-1]?r.pop():r.push(e)}),r.join("/")}var p,l=((p=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(l,r);var n,c,f,p=u(l);function l(){var e;return a(this,l),(e=p.apply(this,arguments)).DB_VERSION=1,e.DB_NAME="Disc",e._writeCmds=["add","put","delete"],e}return n=l,f=[{key:"doUpgrade",value:function(e){var t=e.target.result;switch(e.oldVersion){case 0:case 1:default:t.objectStoreNames.contains("FileStorage")&&t.deleteObjectStore("FileStorage"),t.createObjectStore("FileStorage",{keyPath:"path"}).createIndex("by_folder","folder")}}}],(c=[{key:"initDb",value:function(){var e=this;return(0,s.Z)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e._db){t.next=2;break}return t.abrupt("return",e._db);case 2:if("indexedDB"in window){t.next=4;break}throw e.unavailable("This browser doesn't support IndexedDB");case 4:return t.abrupt("return",new Promise(function(t,r){var n=indexedDB.open(e.DB_NAME,e.DB_VERSION);n.onupgradeneeded=l.doUpgrade,n.onsuccess=function(){e._db=n.result,t(n.result)},n.onerror=function(){return r(n.error)},n.onblocked=function(){console.warn("db blocked")}}));case 5:case"end":return t.stop()}},t)}))()}},{key:"dbRequest",value:function(e,r){var n=this;return(0,s.Z)(regeneratorRuntime.mark(function a(){var o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o=-1!==n._writeCmds.indexOf(e)?"readwrite":"readonly",a.abrupt("return",n.initDb().then(function(n){return new Promise(function(a,i){var u,c=(u=n.transaction(["FileStorage"],o).objectStore("FileStorage"))[e].apply(u,t(r));c.onsuccess=function(){return a(c.result)},c.onerror=function(){return i(c.error)}})}));case 2:case"end":return a.stop()}},a)}))()}},{key:"dbIndexRequest",value:function(e,r,n){var a=this;return(0,s.Z)(regeneratorRuntime.mark(function o(){var i;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=-1!==a._writeCmds.indexOf(r)?"readwrite":"readonly",o.abrupt("return",a.initDb().then(function(a){return new Promise(function(o,u){var c,s=(c=a.transaction(["FileStorage"],i).objectStore("FileStorage").index(e))[r].apply(c,t(n));s.onsuccess=function(){return o(s.result)},s.onerror=function(){return u(s.error)}})}));case 2:case"end":return o.stop()}},o)}))()}},{key:"getPath",value:function(e,t){var r=void 0!==t?t.replace(/^[/]+|[/]+$/g,""):"",n="";return void 0!==e&&(n+="/"+e),""!==t&&(n+="/"+r),n}},{key:"clear",value:function(){var e=this;return(0,s.Z)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initDb();case 2:t.sent.transaction(["FileStorage"],"readwrite").objectStore("FileStorage").clear();case 3:case"end":return t.stop()}},t)}))()}},{key:"readFile",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),r.next=3,t.dbRequest("get",[n]);case 3:if(void 0!==(a=r.sent)){r.next=6;break}throw Error("File does not exist.");case 6:return r.abrupt("return",{data:a.content?a.content:""});case 7:case"end":return r.stop()}},r)}))()}},{key:"writeFile",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n,a,o,i,u,c,s,f,d,p;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),a=e.data,o=e.recursive,r.next=5,t.dbRequest("get",[n]);case 5:if(!(i=r.sent)||"directory"!==i.type){r.next=8;break}throw"The supplied path is a directory.";case 8:return u=e.encoding,c=n.substr(0,n.lastIndexOf("/")),r.t0=void 0,r.next=12,t.dbRequest("get",[c]);case 12:if(r.t1=r.sent,r.t0!==r.t1){r.next=19;break}if(-1===(s=c.indexOf("/",1))){r.next=19;break}return f=c.substr(s),r.next=19,t.mkdir({path:f,directory:e.directory,recursive:o});case 19:return d=Date.now(),p={path:n,folder:c,type:"file",size:a.length,ctime:d,mtime:d,content:!u&&a.indexOf(",")>=0?a.split(",")[1]:a},r.next=22,t.dbRequest("put",[p]);case 22:return r.abrupt("return",{uri:p.path});case 23:case"end":return r.stop()}},r)}))()}},{key:"appendFile",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n,a,o,i,u,c,s,f,d;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),a=e.data,o=n.substr(0,n.lastIndexOf("/")),i=Date.now(),u=i,r.next=6,t.dbRequest("get",[n]);case 6:if(!(c=r.sent)||"directory"!==c.type){r.next=9;break}throw"The supplied path is a directory.";case 9:return r.t0=void 0,r.next=12,t.dbRequest("get",[o]);case 12:if(r.t1=r.sent,r.t0!==r.t1){r.next=19;break}if(-1===(s=o.indexOf("/",1))){r.next=19;break}return f=o.substr(s),r.next=19,t.mkdir({path:f,directory:e.directory,recursive:!0});case 19:return void 0!==c&&(a=c.content+a,u=c.ctime),d={path:n,folder:o,type:"file",size:a.length,ctime:u,mtime:i,content:a},r.next=23,t.dbRequest("put",[d]);case 23:case"end":return r.stop()}},r)}))()}},{key:"deleteFile",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),r.t0=void 0,r.next=4,t.dbRequest("get",[n]);case 4:if(r.t1=r.sent,r.t0!==r.t1){r.next=7;break}throw Error("File does not exist.");case 7:return r.next=9,t.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(n)]);case 9:if(r.t2=r.sent.length,0===r.t2){r.next=12;break}throw Error("Folder is not empty.");case 12:return r.next=14,t.dbRequest("delete",[n]);case 14:case"end":return r.stop()}},r)}))()}},{key:"mkdir",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n,a,o,i,u,c,s,f,d;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),a=e.recursive,o=n.substr(0,n.lastIndexOf("/")),i=(n.match(/\//g)||[]).length,r.next=6,t.dbRequest("get",[o]);case 6:return u=r.sent,r.next=9,t.dbRequest("get",[n]);case 9:if(c=r.sent,1!==i){r.next=12;break}throw Error("Cannot create Root directory");case 12:if(void 0===c){r.next=14;break}throw Error("Current directory does already exist.");case 14:if(a||2===i||void 0!==u){r.next=16;break}throw Error("Parent directory must exist");case 16:if(!a||2===i||void 0!==u){r.next=20;break}return s=o.substr(o.indexOf("/",1)),r.next=20,t.mkdir({path:s,directory:e.directory,recursive:a});case 20:return f=Date.now(),d={path:n,folder:o,type:"directory",size:0,ctime:f,mtime:f},r.next=23,t.dbRequest("put",[d]);case 23:case"end":return r.stop()}},r)}))()}},{key:"rmdir",value:function(t){var r=this;return(0,s.Z)(regeneratorRuntime.mark(function n(){var a,o,i,u,c,s,f,d,p,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.path,o=t.directory,i=t.recursive,u=r.getPath(o,a),n.next=6,r.dbRequest("get",[u]);case 6:if(void 0!==(c=n.sent)){n.next=9;break}throw Error("Folder does not exist.");case 9:if("directory"===c.type){n.next=11;break}throw Error("Requested path is not a directory");case 11:return n.next=13,r.readdir({path:a,directory:o});case 13:if(0===(s=n.sent).files.length||i){n.next=16;break}throw Error("Folder is not empty");case 16:f=e(s.files),n.prev=17,f.s();case 19:if((d=f.n()).done){n.next=34;break}return p=d.value,l="".concat(a,"/").concat(p),n.next=24,r.stat({path:l,directory:o});case 24:if(n.t0=n.sent.type,"file"!==n.t0){n.next=30;break}return n.next=28,r.deleteFile({path:l,directory:o});case 28:n.next=32;break;case 30:return n.next=32,r.rmdir({path:l,directory:o,recursive:i});case 32:n.next=19;break;case 34:n.next=39;break;case 36:n.prev=36,n.t1=n.catch(17),f.e(n.t1);case 39:return n.prev=39,f.f(),n.finish(39);case 42:return n.next=44,r.dbRequest("delete",[u]);case 44:case"end":return n.stop()}},n,null,[[17,36,39,42]])}))()}},{key:"readdir",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),r.next=3,t.dbRequest("get",[n]);case 3:if(a=r.sent,""===e.path||void 0!==a){r.next=6;break}throw Error("Folder does not exist.");case 6:return r.next=8,t.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(n)]);case 8:return r.t0=r.sent.map(function(e){return e.substring(n.length+1)}),r.abrupt("return",{files:r.t0});case 10:case"end":return r.stop()}},r)}))()}},{key:"getUri",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),r.next=3,t.dbRequest("get",[n]);case 3:if(a=r.sent,r.t0=void 0===a,!r.t0){r.next=9;break}return r.next=8,t.dbRequest("get",[n+"/"]);case 8:a=r.sent;case 9:return r.abrupt("return",{uri:(null==a?void 0:a.path)||n});case 10:case"end":return r.stop()}},r)}))()}},{key:"stat",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){var n,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPath(e.directory,e.path),r.next=3,t.dbRequest("get",[n]);case 3:if(a=r.sent,r.t0=void 0===a,!r.t0){r.next=9;break}return r.next=8,t.dbRequest("get",[n+"/"]);case 8:a=r.sent;case 9:if(void 0!==a){r.next=11;break}throw Error("Entry does not exist.");case 11:return r.abrupt("return",{type:a.type,size:a.size,ctime:a.ctime,mtime:a.mtime,uri:a.path});case 12:case"end":return r.stop()}},r)}))()}},{key:"rename",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._copy(e,!0));case 1:case"end":return r.stop()}},r)}))()}},{key:"copy",value:function(e){var t=this;return(0,s.Z)(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._copy(e,!1));case 1:case"end":return r.stop()}},r)}))()}},{key:"requestPermissions",value:function(){return(0,s.Z)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{publicStorage:"granted"});case 1:case"end":return e.stop()}},e)}))()}},{key:"checkPermissions",value:function(){return(0,s.Z)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{publicStorage:"granted"});case 1:case"end":return e.stop()}},e)}))()}},{key:"_copy",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;return(0,s.Z)(regeneratorRuntime.mark(function a(){var o,i,u,c,f,p,l,h,y,b,v,m,x,g,w,k,R;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(o=t.toDirectory,i=t.to,u=t.from,c=t.directory,i&&u){a.next=4;break}throw Error("Both to and from must be provided");case 4:if(o||(o=c),f=n.getPath(c,u),p=n.getPath(o,i),f!==p){a.next=8;break}return a.abrupt("return");case 8:if(!function(e,t){e=d(e),t=d(t);var r=e.split("/"),n=t.split("/");return e!==t&&r.every(function(e,t){return e===n[t]})}(f,p)){a.next=10;break}throw Error("To path cannot contain the from path");case 10:return a.prev=10,a.next=13,n.stat({path:i,directory:o});case 13:l=a.sent,a.next=29;break;case 16:if(a.prev=16,a.t0=a.catch(10),(h=i.split("/")).pop(),y=h.join("/"),a.t1=h.length>0,!a.t1){a.next=27;break}return a.next=25,n.stat({path:y,directory:o});case 25:a.t2=a.sent.type,a.t1="directory"!==a.t2;case 27:if(!a.t1){a.next=29;break}throw new Error("Parent directory of the to path is a file");case 29:if(!l||"directory"!==l.type){a.next=31;break}throw new Error("Cannot overwrite a directory with a file");case 31:return a.next=33,n.stat({path:u,directory:c});case 33:b=a.sent,v=function(){var e=(0,s.Z)(regeneratorRuntime.mark(function e(t,r,a){var i,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.getPath(o,t),e.next=3,n.dbRequest("get",[i]);case 3:return(u=e.sent).ctime=r,u.mtime=a,e.next=8,n.dbRequest("put",[u]);case 8:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),m=b.ctime?b.ctime:Date.now(),a.t3=b.type,a.next="file"===a.t3?39:"directory"===a.t3?54:91;break;case 39:return a.next=41,n.readFile({path:u,directory:c});case 41:if(x=a.sent,a.t4=r,!a.t4){a.next=46;break}return a.next=46,n.deleteFile({path:u,directory:c});case 46:return a.next=48,n.writeFile({path:i,directory:o,data:x.data});case 48:if(a.t5=r,!a.t5){a.next=53;break}return a.next=52,v(i,m,b.mtime);case 52:a.t5=a.sent;case 53:return a.abrupt("return",void a.t5);case 54:if(!l){a.next=56;break}throw Error("Cannot move a directory over an existing object");case 56:return a.prev=56,a.next=59,n.mkdir({path:i,directory:o,recursive:!1});case 59:if(a.t6=r,!a.t6){a.next=63;break}return a.next=63,v(i,m,b.mtime);case 63:a.next=67;break;case 65:a.prev=65,a.t7=a.catch(56);case 67:return a.next=69,n.readdir({path:u,directory:c});case 69:g=a.sent.files,w=e(g),a.prev=71,w.s();case 73:if((k=w.n()).done){a.next=79;break}return R=k.value,a.next=77,n._copy({from:"".concat(u,"/").concat(R),to:"".concat(i,"/").concat(R),directory:c,toDirectory:o},r);case 77:a.next=73;break;case 79:a.next=84;break;case 81:a.prev=81,a.t8=a.catch(71),w.e(a.t8);case 84:return a.prev=84,w.f(),a.finish(84);case 87:if(a.t9=r,!a.t9){a.next=91;break}return a.next=91,n.rmdir({path:u,directory:c});case 91:case"end":return a.stop()}},a,null,[[10,16],[56,65],[71,81,84,87]])}))()}}])&&o(n.prototype,c),f&&o(n,f),l}(f.Uw))._debug=!0,p)}}])}();